<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<title>Book Quest - AI Book Builder</title>
		<style>
			* {
				box-sizing: border-box;
			}
			body {
				font-family: Arial, Helvetica, sans-serif;
				background-color: #f1f1f1;
			}
			.container {
				width: 100%;
				max-width: 600px;
				margin: 0 auto;
				padding: 20px;
				background-color: #fff;
			}
			#header {
				text-align: center;
			}
			#askAI {
				margin-top: 20px;
			}
			#response {
				margin-top: 20px;
			}
			#conversationMemory {
				margin-top: 20px;
			}
			#conversationMemory textarea {
				height: 200px;
			}
			#conversationMemory label {
				display: block;
			}
			#askAI textarea {
				width: 100%;
				height: 200px;
			}
			#askAI label {
				display: block;
			}
			#response textarea {
				width: 100%;
				height: 200px;
			}
			#response label {
				display: block;
			}
			#header label {
				display: block;
			}
			#header input {
				width: 100%;
				margin-bottom: 10px;
			}
			#header button {
				display: block;
				margin: 0 auto;
			}
			#logo {
				width: 100%;
				max-width: 300px;
				margin: 0 auto;
				display: block;
				border-radius: 50%;
			}

			#conversationMemory textarea {
				width: 100%;
				height: 200px;
			}

			#conversationMemory label {
				display: block;
			}

			#askAI textarea {
				width: 100%;
				height: 200px;
			}

			#askAI label {
				display: block;
			}

			#response textarea {
				width: 100%;
				height: 200px;
			}

			#response label {
				display: block;
			}

			#header label {
				display: block;
			}

			#header input {
				width: 100%;
				margin-bottom: 10px;
			}

			#gptModel {
				display: block;
				margin: 0 auto;
				width: 100%;
				margin-bottom: 10px;
			}
			#gptModel option {
				display: block;
				margin: 0 auto;
				width: 100%;
				margin-bottom: 10px;
			}

			#clearMemoryButton {
				display: block;
				margin: 0 auto;
			}

			#clearMemoryButton:hover {
				cursor: pointer;
				background-color: #ddd;
			}

			#header button {
				display: block;
				margin: 0 auto;
			}

			#header h1 {
				text-align: center;
			}

			#header label {
				display: block;
			}

			#header input {
				width: 100%;
				margin-bottom: 10px;
			}
			#header button {
				display: block;
				margin: 0 auto;
			}
			#logo {
				width: 100%;
				max-width: 300px;
				margin: 0 auto;
				display: block;
				border-radius: 50%;
			}

			#changeKeys {
				display: block;
				margin: 0 auto;
			}

			#changeKeys:hover {
				cursor: pointer;
				background-color: #ddd;
			}

			#askButton {
				display: block;
				margin: 0 auto;
			}

			#askButton:hover {
				cursor: pointer;
				background-color: #ddd;
			}

			#saveButton {
				display: block;
				margin: 0 auto;
			}

			#saveButton:hover {
				cursor: pointer;
				background-color: #ddd;
			}

			select {
				width: 100%;
				padding: 16px 20px;
				border: none;
				border-radius: 4px;
				background-color: #f1f1f1;
			}
			option {
				width: 100%;
				padding: 16px 20px;
				border: none;
				border-radius: 4px;
				background-color: #f1f1f1;
			}
			select:focus {
				outline: none;
			}
			#askButton {
				display: block;
				margin: 0 auto;
				width: 100%;
				margin-bottom: 10px;
			}
			#askButton:hover {
				cursor: pointer;
				background-color: #ddd;
			}
			#saveButton {
				display: block;
				margin: 0 auto;
				width: 100%;
				margin-bottom: 10px;
			}
			#saveButton:hover {
				cursor: pointer;
				background-color: #ddd;
			}
			#theme {
				width: 100%;
				margin-bottom: 10px;
			}
			#theme:focus {
				outline: none;
			}
			#apiKey {
				width: 100%;
				margin-bottom: 10px;
			}
			#apiKey:focus {
				outline: none;
			}
			#bookCategory {
				width: 100%;
				margin-bottom: 10px;
			}
			#bookCategory:focus {
				outline: none;
			}

			@media screen and (max-width: 600px) {
				.container {
					width: 100%;
				}
			}
		</style>
	</head>
	<body>
		<div class="container" id="header">
			<h1>Book Quest - AI Book Builder</h1>
			<!-- <img src="./brmountains.jpg" alt="" id="logo" /> -->
			<label for="">API Key</label>
			<input type="text" id="apiKey" />
			<button id="saveButton">Save</button>
			<button id="changeKeys" style="display: none">Change ApiKeys</button>
		</div>
		<div class="container" id="askAI">
			<select name="" id="bookCategory">
				<option value="null">Choose Category</option>
				<option value="scifi">Sci-Fi</option>
				<option value="fantasy">Fantasy</option>
				<option value="romance">Romance</option>
				<option value="mystery">Mystery</option>
				<option value="thriller">Thriller</option>
				<option value="horror">Horror</option>
				<option value="western">Western</option>
				<option value="drama">Drama</option>
				<option value="action">Action</option>
				<option value="adventure">Adventure</option>
				<option value="comedy">Comedy</option>
				<option value="satire">Satire</option>
				<option value="tragedy">Tragedy</option>
				<option value="mythology">Mythology</option>
				<option value="science">Science</option>
				<option value="crime">Crime</option>
				<option value="historical">Historical</option>
				<option value="children">Children</option>
				<option value="nonfiction">Nonfiction</option>
				<option value="biography">Biography</option>
				<option value="autobiography">Autobiography</option>
				<option value="poetry">Poetry</option>
				<option value="essay">Essay</option>
				<option value="comic">Comic</option>
				<option value="graphicnovel">Graphic Novel</option>
				<option value="cookbook">Cookbook</option>
				<option value="diary">Diary</option>
			</select>
			<label for="">Begin Story</label>
			<h3>Add Theme</h3>
			<input placeholder="add theme" type="text" id="theme" />
			<button id="askButton">Ask</button>
		</div>
		<div class="container" id="response">
			<label for="">Response</label>
			<textarea name="" id="answer" cols="30" rows="10"> </textarea>
		</div>
		<script>
			let currentAnswer = "";

			const theme = document.getElementById("theme");
			const answer = document.getElementById("answer");
			const conversation = document.getElementById("conversation");
			const askButton = document.getElementById("askButton");
			const saveButton = document.getElementById("saveButton");

			saveButton.addEventListener("click", () => {
				if (localStorage.getItem("apiKey") !== null) {
					if (
						!confirm("Are you sure you want to overwrite your current API key?")
					) {
						return;
					}
				}
				localStorage.setItem("apiKey", document.getElementById("apiKey").value);
				alert("API key saved");
				document.getElementById("apiKey").value = "";
			});

			askButton.addEventListener("click", () => {
				const theme = document.getElementById("theme").value;
				const bookCategory = document.getElementById("bookCategory").value;
				const questionObject = {};
				if (theme === "") {
					alert("Please add a theme");
					return;
				}
				if (bookCategory === "null") {
					alert("Please choose a category");
					return;
				}

				const questionArray2 = [
					"Who is the main character?",
					"What is the main character's primary goal?",
					"What are the main character's key traits or qualities?",
					"Who is the antagonist and what motivates them?",
					"What are the key characteristics of other supporting characters?",
					"Where and when does the story take place? (Setting)",
					"What is the central conflict of the story?",
					"How does the main conflict develop? (Key events leading to the conflict)",
					"How does the main character plan to overcome the conflict?",
					"What challenges or obstacles does the main character face?",
					"How do the main character's actions impact the story's progression?",
					"What are the pivotal moments in the story?",
					"How do the supporting characters influence the main conflict?",
					"What is the climax of the story? (The peak of the main conflict)",
					"How is the main conflict resolved?",
					"What is the story's resolution or ending?",
					"What themes or messages are explored in the story?",
					"How does the setting influence the story's events?",
					"What is the emotional journey of the main character?",
					"How does the main character evolve throughout the story?",
					"What is the main character's backstory?",
					"What is the main character's motivation?",
					"What is the main character's primary flaw?",
					"What is the main character's greatest strength?",
					"What is the main character's greatest weakness?",
					"What is the main character's greatest fear?",
					"What is the main character's greatest desire?",
					"What is the main character's greatest regret?",
					"What is the main character's greatest accomplishment?",
					"What is the main character's greatest failure?",
					"What is the main character's greatest secret?",
					"What is the main character's greatest hope?",
					"What is the main character's greatest dream?",
					"What is the main character's greatest nightmare?",
					"What is the main character's greatest challenge?",
					"What is the main character's greatest obstacle?",
				];
				const questionArray = [
					"what is your name?",
					"what is your age?",
					"what is your favorite color?",
					"what is your favorite food?",
					"what is your favorite animal?",
					"what is your favorite movie?",
					"what is your favorite book?",
					"what is your favorite song?",
					"what is your favorite sport?",
					"what is your favorite game?",
					"what is your favorite subject?",
					"what is your favorite hobby?",
					"what is your favorite place?",
					"what is your favorite country?",
					"what is your favorite city?",
					"what is your favorite state?",
					"what is your favorite planet?",
					"what is your favorite car?",
					"what is your favorite bike?",
					"what is your favorite flower?",
					"what is your favorite tree?",
					"what is your favorite vegetable?",
					"what is your favorite fruit?",
					"what is your favorite drink?",
					"what is your favorite restaurant?",
					"what is your favorite store?",
					"what is your favorite website?",
					"what is your favorite app?",
					// ask real questions
					"what is your favorite book?",
					"what is your favorite movie?",
					"what is your favorite song?",
					// ask questions about friends and family
					"what is your mother's name?",
					"what is your father's name?",

					// ask questions about the future
					"what is your dream job?",
					"what is your dream car?",
					"what is your dream house?",
					"what is your dream vacation?",
					"what is your dream life?",
					// ask questions about the past
					"what is your earliest memory?",
					"what is your favorite childhood memory?",
					"what is your favorite memory?",
					"what is your worst memory?",
					"what is your most embarrassing memory?",

					// ask questions about the present
					"what is your favorite thing to do?",
					"what is your favorite thing to eat?",
					"what is your favorite thing to drink?",
				];
				//prompt user to answer 5 random questions and add to questionObject
				for (let i = 0; i < 5; i++) {
					//get random question from questionArray that hasn't been asked yet
					let question =
						questionArray[Math.floor(Math.random() * questionArray.length)];
					//remove question from questionArray
					questionArray.splice(questionArray.indexOf(question), 1);

					const answer = prompt(question);
					questionObject[question] = answer;
				}
				getAnswer(JSON.stringify(questionObject), theme, bookCategory);
			});

			const openaiURL = "https://api.openai.com/v1/chat/completions";
			const getAnswer = async (info, theme, bookCategory) => {
				askButton.disabled = true;
				askButton.innerHTML = "Asking...";
				let query = `Theme: ${theme}|Info: ${info.trim()}|Category: ${bookCategory}`;
				let gptModel = "gpt-3.5-turbo";

				const messages = [
					{
						role: "system",
						content: `You are a very creative storywriter. Take the following background info, theme, and category, and create a long story: ${query}`,
					},
				];
				try {
					const request = await fetch(openaiURL, {
						method: "POST",
						headers: {
							"Content-Type": "application/json",
							Authorization: "Bearer " + localStorage.getItem("apiKey"),
						},

						body: JSON.stringify({
							model: gptModel,
							messages: messages,
							temperature: 0.7,
						}),
					});
					const response = await request.json();
					const answer = response.choices[0].message.content;
					currentAnswer = answer;

					updateAnswer(answer);
					askButton.disabled = false;
					askButton.innerHTML = "Ask";
				} catch (error) {
					console.log(error);
				}
			};
			const updateAnswer = (answer) => {
				document.getElementById("answer").value = answer;
			};

			//check for query params apikey and store it in local storage
			const urlParams = new URLSearchParams(window.location.search);
			const apiKey = urlParams.get("apikey");
			if (apiKey !== null) {
				localStorage.setItem("apiKey", apiKey);
				alert("API key saved");
				//clear query params
				window.history.replaceState({}, document.title, "/");
			}
			document.getElementById("changeKeys").addEventListener("click", () => {
				localStorage.removeItem("apiKey");
				document.getElementById("apiKey").style.display = "block";
				document.getElementById("saveButton").style.display = "block";
				document.getElementById("changeKeys").style.display = "none";
			});
			//if api key is saved, remove the api key input
			if (localStorage.getItem("apiKey") !== null) {
				document.getElementById("apiKey").style.display = "none";
				document.getElementById("saveButton").style.display = "none";
				document.getElementById("changeKeys").style.display = "block";
			}
		</script>
	</body>
</html>
